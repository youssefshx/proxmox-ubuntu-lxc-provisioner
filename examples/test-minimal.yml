---
#==============================================================================
# PROXMOX UBUNTU LXC PROVISIONER - MINIMAL TEST
#==============================================================================
# Single-container smoke test for quick validation.
# Creates ONE privileged container on ONE host to verify core functionality.
#
# WHAT THIS TESTS:
#   ✓ Container creation (pct create)
#   ✓ Ubuntu 25.04 (Plucky Puffin) template
#   ✓ Network configuration (static IP, gateway, DNS)
#   ✓ SSH key injection and ansible user setup
#   ✓ UFW firewall configuration
#   ✓ Base package installation
#   ✓ System updates
#
# USAGE:
#   ansible-playbook -i inventories/hosts.ini playbooks/provision.yml \
#     -e lxc_map_file=examples/test-minimal.yml
#
# CLEANUP:
#   ansible-playbook -i inventories/hosts.ini playbooks/nuke-provision.yml \
#     -e lxc_map_file=examples/test-minimal.yml
#
# ESTIMATED TIME: ~3-5 minutes
#==============================================================================

#------------------------------------------------------------------------------
# LXC DEFAULTS
#------------------------------------------------------------------------------
lxc_defaults:
  # Ubuntu 24.04 LTS (Noble Numbat)
  template: "gold-public:vztmpl/ubuntu-24.04-standard_24.04-2_amd64.tar.zst"

  # Network configuration
  bridge: vmbr0
  vlan_tag: 0
  gateway: 10.0.0.1
  dns: "1.1.1.1"

  # Container resources
  memory: 2048
  cores: 2

#------------------------------------------------------------------------------
# SINGLE TEST CONTAINER
#------------------------------------------------------------------------------
lxc_containers:
  # Minimal smoke test - privileged on local-lvm
  - id: 9900
    host: 10.22.11.6
    hostname: test-minimal
    ip: 10.0.99.1/16
    provision_type: privileged
    memory: 2048
    cores: 2
    rootfs: local-lvm:10

#==============================================================================
# POST-PROVISIONING VERIFICATION
#==============================================================================
# Quick validation commands:
#
# 1. Test Ansible connectivity:
#    cd output/test-minimal
#    ansible all -m ping
#
# 2. SSH directly:
#    ssh -i test-minimal.pem ansible@10.0.99.1
#
# 3. Container status (from Proxmox host):
#    pct status 9900
#    pct exec 9900 -- ufw status
#    pct exec 9900 -- ping -c 3 8.8.8.8
#==============================================================================
